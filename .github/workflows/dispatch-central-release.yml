name: dispatch-central-release

on:
  push:
    branches: [main]

permissions:
  contents: read

jobs:
  dispatch:
    runs-on: ubuntu-latest
    steps:
      - name: Dispatch to infra central orchestrator
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.CENTRAL_DISPATCH_TOKEN }}
          script: |
            await github.rest.repos.createDispatchEvent({
              owner: 'one-year-gap',
              repo: 'infra',
              event_type: 'release-request',
              client_payload: {
                source_repo: context.repo.owner + '/' + context.repo.repo,
                source_sha: context.sha,
                source_ref: context.ref
              }
            });